# LAMMPS Input Script for Thermal Conductivity via Green-Kubo (GK) Method

# -------------------- 1. INITIALIZATION --------------------
# Use real units (kcal/mol, Angstroms, femtoseconds, etc.)
units          metal
atom_style     atomic
boundary       p p p          # Periodic boundary conditions in all directions

# -------------------- 2. SYSTEM SETUP --------------------
# Create the simulation box and atoms (simplified LJ solid)
# For a polymer, you would use: read_data polymer.data
lattice        fcc 0.86       # FCC lattice with a reduced density (rho* = 1.0)
region         box block 0 10 0 10 0 10
create_box     1 box
create_atoms   1 box

# Set masses
mass           1 40.0         # Mass of generic atom (e.g., Argon)

# -------------------- 3. FORCE FIELD PARAMETERS --------------------
# Simplified Lennard-Jones potential (for a quick, runnable example)
# NOTE: For polymers, you would use a force field like OPLS-AA or GAFF
# which requires pair_style lj/class2, bond_style harmonic, etc., and a data file.
pair_style     lj/cut 10.0
pair_coeff     1 1 0.010 3.4   # epsilon = 0.010 eV, sigma = 3.4 Angstrom

# -------------------- 4. EQUILIBRATION --------------------

# Group all atoms
group          all type 1

# Minimization to relax initial structure
thermo         100
thermo_style   custom step temp pe etotal
minimize       1.0e-4 1.0e-6 100 1000

# Step 1: NPT Relaxation (Constant pressure and temperature)
# The system must be equilibrated to a specific density at the target T and P.
reset_timestep 0
velocity       all create 300.0 12345 dist gaussian
fix            1 all npt temp 300.0 300.0 100.0 iso 0.0 0.0 1000.0
run            50000

# Step 2: NVT Thermalization (Constant volume and temperature)
# Ensure the temperature is stable before starting the production run.
unfix          1
fix            2 all nvt temp 300.0 300.0 100.0
run            20000

# -------------------- 5. PRODUCTION RUN (NVE & GK Calculation) --------------------

# Unfix the thermostat/barostat and switch to NVE
unfix          2
fix            3 all nve

# Define the temperature and pressure for post-processing
variable       T equal 300.0
variable       V equal vol
variable       KB equal 1.380649e-23   # Boltzmann constant (J/K)
variable       dt equal 0.001          # Time step in ps (since units metal)

# Compute the total heat flux vector (J)
compute        flux all heat/flux
variable       Jx equal c_flux[1]
variable       Jy equal c_flux[2]
variable       Jz equal c_flux[3]

# Compute the Heat Flux Autocorrelation Function (HFACF) using 'fix ave/correlate'
# The correlation is calculated for the components (Jx, Jy, Jz) independently.
# time_delay = 100 * dt = 0.1 ps. Correlation time = 500 * dt = 0.5 ps.
# The correlation function C(t) = <J(t_0) . J(t_0 + t)>
fix            4 all ave/correlate 1 100 500 c_flux[1] c_flux[2] c_flux[3] type auto file hfacf.dat
# 1000 total averaging blocks (1 run * 100 samples/block * 10 steps/sample = 100,000 steps)
# Total run time = 1000 * 100 * 10 steps = 1,000,000 timesteps

# Thermodynamic output for the production run
thermo_style   custom step temp etotal press
thermo         10000

# Run the NVE production with flux collection
run            1000000

# -------------------- 6. POST-PROCESSING CALCULATION (In Python) --------------------
# The final thermal conductivity (kappa) calculation requires integrating the HFACF.
# The formula is: kappa = (1 / 3 V k_B^2 T^2) * Integral_0^inf (<J(t).J(0)> dt)

print "Simulation finished. HFACF saved to hfacf.dat."
print "Run the 'gk_post_process.py' script to calculate final kappa."
